<ion-content>

  <app-header  [customContainer]="true" [hiddenBackButton]="true" [headerTitle]="regionFilterName" >
   <div class="header-container">
      <button (click)="openRegionModal()" class="header__open-region-modal">
          {{regionFilterName}}
         <img src="/assets/icons/arrow_down.svg" alt="">
      </button>
      <div class="header__filter-grid">
        <app-icon-button (click)="setFilterInTape('all')" height="little-height" clippy="clippy-right" buttonText="Все" [theme]="allFilter ? 'red':'dark'"></app-icon-button>
        <app-icon-button (click)="setFilterInTape('current')" height="little-height" clippy="clippy-right" buttonText="Текущие"  [theme]="currentFilter ? 'red':'dark'"></app-icon-button>
        <app-icon-button (click)="setFilterInTape('expired')" height="little-height" clippy="clippy-right" buttonText="Прошедшие"  [theme]="expiredFilter ? 'red':'dark'"></app-icon-button>
      </div>
   </div>
  </app-header>

  <app-regions-select-modal (select)="filterEventsInLocation($event)" [selectedRegion]="regionFilterName" [visible]="regionModalState" (onClose)="closeRegionModal()" [regions]="searchRegionItems"> </app-regions-select-modal>
 <div class="main-container--with-header--strong events">
  <div class="events">
    <ng-container *ngIf="currentFilter">
      <div *ngFor="let group of formatedEvents" class="events-grid">
        <div class="month-container">
          <span class="month">{{group.groupMonth}}</span>
          <div class="month-shape"></div>
        </div>
    
        <div  *ngFor="let event of group.events; let i = index">
          <app-event-card [event]="event" >
            <div *ngIf="userService.userHaveRoot() && event.commissions_exists" class="button-container">
              <app-standart-button style="width: 100%;" (click)="generateGoogleLink(event.id)" buttonText="Выгрузить список"></app-standart-button>
              <app-standart-button style="width: 100%;" (click)="openUploadResultModal(event)" buttonText="Добавить результаты"></app-standart-button>
            </div>
          </app-event-card>
        </div>
      </div>
    </ng-container>
  
    <ng-container *ngIf="expiredFilter">
      <div *ngFor="let group of formatedExpiredEvents" class="events-grid">
        <div class="month-container">
          <span class="month">{{group.groupMonth}}</span>
          <div class="month-shape"></div>
        </div>
          <div  *ngFor="let event of group.events; let i = index">
            <app-event-card [event]="event">
              <div *ngIf="userService.userHaveRoot()" class="button-container">
                <app-standart-button style="width: 100%;" (click)="generateGoogleLink(event.id)" buttonText="Выгрузить список"></app-standart-button>
                <app-standart-button style="width: 100%;" (click)="openUploadResultModal(event)" buttonText="Добавить результаты"></app-standart-button>
              </div>
            </app-event-card>
          </div>
      </div>
    </ng-container>
  
    <ng-container *ngIf="allFilter">
      <div *ngFor="let group of formatedEvents" class="events-grid">
        <div class="month-container">
          <span class="month">{{group.groupMonth}}</span>
          <div class="month-shape"></div>
        </div>
        <div  *ngFor="let event of group.events; let i = index">
          <app-event-card [event]="event" >
            <div *ngIf="userService.userHaveRoot() && event.commissions_exists" class="button-container">
              <app-standart-button style="width: 100%;" (click)="generateGoogleLink(event.id)" buttonText="Выгрузить список"></app-standart-button>
              <app-standart-button style="width: 100%;" (click)="openUploadResultModal(event)" buttonText="Добавить результаты"></app-standart-button>
            </div>
          </app-event-card>
        </div>
      </div>
      <div *ngFor="let group of formatedExpiredEvents" class="events-grid">
        <div class="month-container">
          <span class="month">{{group.groupMonth}}</span>
          <div class="month-shape"></div>
        </div>
          <div  *ngFor="let event of group.events; let i = index">
            <app-event-card [event]="event">
              <div *ngIf="userService.userHaveRoot()" class="button-container">
                <app-standart-button style="width: 100%;" (click)="generateGoogleLink(event.id)" buttonText="Выгрузить список"></app-standart-button>
                <app-standart-button style="width: 100%;" (click)="openUploadResultModal(event)" buttonText="Добавить результаты"></app-standart-button>
              </div>
            </app-event-card>
          </div>
      </div>
    </ng-container>
  </div>
  
 </div>

 
    
</ion-content>

<ion-modal [isOpen]="tableModalValue">
  <ng-template>
    <ion-content>
      <div class="google-tabs">
        <div class="google-tabs__modal-text">
            Список участников был отправлен на вашу почту {{userService.user.value?.email}}
            Сейчас можно открыть его по
          <a class="google-tabs__modal-text__link" target="_blank" [href]="googleTabsLink">этой ссылке</a>
        </div>
        <app-standart-button (click)="closetTableModal()" style="width: 100%;" buttonText="Закрыть" theme="light"></app-standart-button>
      </div>
    </ion-content>
  </ng-template>
  
</ion-modal>
  
<ion-modal class="upload-result-modal" (didDismiss)="closeUploadResultModalState()" [isOpen]="uploadResultModalState">
  <ng-template>
    <ion-content>
      <app-header headerTitle="Результаты гонки" [customBack]="true" (customBackClick)="closeUploadResultModalState()">
      </app-header>
        <div class="main-container--with-header">
            <article class="add-result">
              <app-upload-file-input [resultsFilesUpload]="resultsFilesUploadArrayClear" [clearUploadFiles]="clearUploadFiles" [allowedTypes]="['application/pdf']" (resultsFilesUploadEmit)="getUploadResultsFiles($event)"></app-upload-file-input>
              <div class="save-result-button-wrapper">
                <app-standart-button style="width: 100%;" (click)="submitResultInRace()" buttonText="Сохранить"></app-standart-button>
              </div>
              <app-no-data-found [show]="!currentRace.pdf_files" message="Результаты гонки не добавлены"></app-no-data-found>
              <ng-container *ngIf="currentRace.pdf_files">
                <div class="documents-grid">
              
                    <ng-container *ngFor="let document of formattedResultsDocument"> 
                      <div class="documents-grid__item">
                        <div class="delete-button-container">
                          <app-circle-button (click)="deleteResultFile(document)" icon="/assets/icons/trash.svg"></app-circle-button>
                        </div>
                        <pdf-viewer [src]="document.path | checkImgUrl" [zoom]="document.zoomLevel"
                        [render-text]="true"
                        [original-size]="false"
                        
                        class="file__img"
                        ></pdf-viewer>
                        <div class="button-container--pdf">
                          <app-circle-button class="circle-button" [icon]="'assets/icons/plus.svg'" (click)="zoomIn(document)"></app-circle-button>
                          <app-circle-button class="circle-button" [icon]="'assets/icons/minus.svg'" (click)="zoomOut(document)"></app-circle-button>
                          <app-circle-button class="circle-button" [icon]="'assets/icons/close.svg'" (click)="resetZoom(document)"></app-circle-button>
                        </div>
                      </div>                  
                    
                    </ng-container>
              
                </div>
              </ng-container>
            </article>
        </div>
    </ion-content>
  </ng-template>
</ion-modal>

