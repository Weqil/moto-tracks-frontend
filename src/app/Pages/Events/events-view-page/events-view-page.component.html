<ion-content>
  <main>
    @if (this.event) {
      <div class="slider-container">
        <app-show-slider [files]="event.images"></app-show-slider>
        <div class="slider-container__header">
          <app-back-button ></app-back-button>
          
        </div>
      </div>
      <div class="main-container">
        <div class="event-container">
          <div class="event-date">
            {{event.date_start | date :'Дата проведения: dd.MM.YYYY'}}
          </div>
        </div>
        

        <div class="event-name">{{event.name}}</div>
        @if (usersInRace.length) {
          <app-users-preview [fullValueUsers]="usersInRace.length" [users]="usersInRace" [moreCount]="usersInRace.length" [openUsersModal]="openUserModalValue" (closeModalEmit)="closeStateUsersModal()" (openModalEmit)="openStateUsersModal()"></app-users-preview>
        }
        <div [innerHTML]="clearDescription()" class="event-description">{{event.desc}}</div>

        <div *ngIf="event.grades && event.grades.length" class="groups">
          <span class="groups-header">Классы сорвевнования:</span>
          <div class="group-item" *ngFor="let group of event.grades">
            <div class="group-item__name">{{group.name}}</div>
          </div>
        </div>
        
        <div *ngIf="event.position_file || event.results_file" class="event-documents">
           <span *ngIf="event.results_file" [routerLink]="['/view-document', event.results_file | checkImgUrl]" class="event-documents__text">Регламент <img class="event-documents__icon" src="/assets/icons/documents.svg" alt=""></span>
          <span *ngIf="event.position_file" [routerLink]="['/view-document', event.position_file | checkImgUrl]" class="event-documents__text">Положение <img class="event-documents__icon" src="/assets/icons/documents.svg" alt=""></span>
        </div>
        <div class="event-track">
          <!-- <div class="event-track__title">Где проходит</div> -->
          <app-track-section (click)="redirectInRace()" [track]="event.track"></app-track-section>
        </div>
      </div>
      
      <div class="footer">
          @if (!this.event.appointments_exists) {
            <app-standart-button (click)="openApplicationForm()" buttonText="Заявиться" theme="big"></app-standart-button>
          }
          @else {
            <app-standart-button [disabled]="true"  buttonText="Заявка отправлена"></app-standart-button>
          }
    
        </div>
       
    }
  </main>

</ion-content>

@if (this.event) {
<ion-modal [isOpen]="applicationFormValueState" (didDismiss)="closeApplicationForm()">
  <ng-template>
    <ion-content >
      <app-header (customBackClick)="closeApplicationForm()" [customBack]="true" headerTitle="Отправить заявку"></app-header>
      <div class="main-container--with-header application-main">
        <div class="race-name">{{event.name}}</div>
        <div class="race-date-start">{{event.date_start |date}}</div>
        <form class="personal-form">
          <app-standart-input [control]="personalUserForm.get('surname')" placeholder="Введите фамилию" [errorMessage]="formErrors.surname.errorMessage" [invalid]="formErrors.surname.errorMessage.length !== 0" label="Фамилия"></app-standart-input>
          <app-standart-input [control]="personalUserForm.get('name')" [errorMessage]="formErrors.name.errorMessage" [invalid]="formErrors.name.errorMessage.length !== 0" placeholder="Введите имя" label="Имя"></app-standart-input>
          <app-standart-input [control]="personalUserForm.get('patronymic')" placeholder="Введите отчество" label="Отчество"></app-standart-input>
          <app-standart-input [control]="personalUserForm.get('dateOfBirth')" placeholder="Выберите дату" label="Дата рождения" type="date"></app-standart-input>
          <app-standart-input (click)="openRegionModal()" [readonly]="true" label="Область/край" [control]="personalUserForm.get('region')" placeholder="Выберите область вашу область"></app-standart-input>     
          <app-standart-input [control]="personalUserForm.get('city')" [errorMessage]="formErrors.city.errorMessage" [invalid]="formErrors.city.errorMessage.length !== 0" placeholder="Введите город" label="Город"></app-standart-input>     
          <ion-modal class="region-modal" (didDismiss)="closeRegionModal()"  [isOpen]="regionModalState">
            <ng-template>
              <ion-content>
                <div class="region-modal-container">
                  <app-standart-input-search label="Область/край" [searchCurrentItems]="searchRegionItems" [searchItems]="searchRegionItems" (changeSearchValue)="setRegion($event)"></app-standart-input-search>
                </div>
              </ion-content>
            </ng-template>  
          </ion-modal>        
          
          <app-standart-input [control]="personalUserForm.get('numberAndSeria')" placeholder="Серия, номер" label="Паспорт"></app-standart-input>

          <div class="start-number-container">
            <app-standart-input [control]="personalUserForm.get('inn')" placeholder="ИНН" label="ИНН"></app-standart-input>
            <app-standart-input [control]="personalUserForm.get('snils')" placeholder="СНИЛС" label="СНИЛС"></app-standart-input>
          </div>
          <app-standart-input [control]="personalUserForm.get('phoneNumber')" placeholder="Номер телефона" label="Телефон"></app-standart-input>
          <div class="start-number-container">
            <app-standart-input [control]="personalUserForm.get('startNumber')" [maxLength]="3" type="number" [invalid]="formErrors.startNumber.errorMessage.length !== 0" [errorMessage]="formErrors.startNumber.errorMessage" placeholder="Стартовый номер" label="Стартовый номер"></app-standart-input>
          </div>
          <app-standart-input-select selectedName="groupSelect" [items]="groupItems" (onChange)="setGroup($event)" [selectedItem]="{name:personalUserForm.value.group, value:personalUserForm.value.group}" label="Класс, группа"></app-standart-input-select>
          <app-standart-input-select selectedName="rankSelect" [items]="sportRankItems" (onChange)="setRank($event)" [selectedItem]="{name:personalUserForm.value.rank, value:personalUserForm.value.rank}" label="Спортивное звание, разряд"></app-standart-input-select>
          <app-standart-input [control]="personalUserForm.get('rankNumber')" placeholder="№ удостоверения (МСМК, МС, КМС)" label="№ удостоверения"></app-standart-input>
          <app-standart-input [control]="personalUserForm.get('community')" placeholder="Команда" label="Навзание команды"></app-standart-input>
          <app-standart-input [control]="personalUserForm.get('coach')" placeholder="Тренер" label="ФИО тренера"></app-standart-input>
          <app-standart-input-select selectedName="motoStampSelect" [items]="motoStampItems" (onChange)="setMotoStamp($event)" [selectedItem]="{name:personalUserForm.value.motoStamp, value:personalUserForm.value.motoStamp}" label="Марка мотоцикла"></app-standart-input-select>
          <app-standart-input-select selectedName="engineSelect" [items]="engineItems" (onChange)="setEngine($event)" [selectedItem]="{name:personalUserForm.value.engine, value:personalUserForm.value.engine}" label="Тип двигателя"></app-standart-input-select>
        </form>
        
        <div class="documents">
            <div class="document-header">Лицензия</div>
            <div class="licenses document-container">
              <app-standart-input [control]="licensesForm.get('licensesNumber')" placeholder="Лицензия МФР" label="Лицензия МФР (тип, №):"></app-standart-input>
              <span class="scan-header">Скан или фотография Лицензии</span>
              <app-file-input (click)="!licensesFile ? licensesFileInput.click(): showToastInfoFileUpload()" [fileName]="licensesFile.name"></app-file-input>
              <input (change)="setLicensesFile($event)" #licensesFileInput style="display: none;"  type="file">
            </div>

            <div class="document-header">Страховой полис</div>
            <div class="polis document-container">
              <app-standart-input [control]="polisForm.get('polisNumber')" placeholder="Серия, номер" label="Серия и номер"></app-standart-input>
              <app-standart-input [control]="polisForm.get('issuedWhom')" placeholder="Кем выдан" label="Кем выдан"></app-standart-input>
              <app-standart-input [control]="polisForm.get('itWorksDate')" placeholder="Срок действия" type="date" label="Срок действия"></app-standart-input>
              <span class="scan-header">Скан или фотография Полиса</span>
              <app-file-input [fileName]="polisFile.name" (click)="!polisFile ? polisFileInput.click(): showToastInfoFileUpload()"></app-file-input>
              <input (change)="setPolisFile($event)" #polisFileInput style="display: none;"  type="file">
            </div>
            <div class="document-header">Нотариальное согласие родителей</div>
            <div class="polis document-container">
              <span class="scan-header">Скан или фотография Нотариального согласия</span>
            <app-file-input [fileName]="notariusFile.name" (click)="!notariusFile ? notariusFileInput.click(): showToastInfoFileUpload()"></app-file-input>
              <input (change)="setNotariusFile($event)" #notariusFileInput style="display: none;"  type="file">
            </div>

        </div>
        
      </div>
      <div class="footer">
        <app-standart-button theme="big" (click)="toggleAplicationInRace()" buttonText="Заявиться"></app-standart-button>
      </div>
    </ion-content>
  </ng-template>
  
  
  </ion-modal>

<app-confirm-modal text="Ваши данные были изменены, сохранить их?" [openModal]="changePersonalDateModalValue" (confirm)="saveNewPersonal()" (cancel)="closePersonalNewModal()" ></app-confirm-modal>
}